# âš« ë¡œê·¸ì•„ì›ƒê³¼  íšŒì›ê°€ì…

### âœ”ï¸ ë¡œê·¸ì•„ì›ƒ

**[ LogoutServlet.java ]** 

```java
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.getSession().invalidate(); //ì„¸ì…˜ ë¬´íš¨í™” , ë¡œê·¸ì•„ì›ƒ
		response.sendRedirect(request.getContextPath());
	}
```

### âœ”ï¸ íšŒì›ê°€ì…

 **[ MemberInsertServet.java ]**

```java
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

		String userId = request.getParameter("userId");
		String userPwd = request.getParameter("userPwd");
		String userName = request.getParameter("userName");
		String email = request.getParameter("email");
		String birthday = request.getParameter("birthday");
		String gender = request.getParameter("gender");
		String phone = request.getParameter("phone");
		String address = request.getParameter("address");
		
		Member m = new Member(userId, userPwd, userName, email, birthday, gender, phone, address);
		
		try {
			memberService.insertMember(m);
			response.sendRedirect(request.getContextPath());

		} catch (Exception e) {

			request.setAttribute("msg", "íšŒì›ê°€ì… ì‹¤íŒ¨");
			request.getRequestDispatcher("WEB-INF/views/common/errorPage.jsp").forward(request, response);
			
			e.printStackTrace();
		}
	}
```

**[ member-mapper.xml ]**

```xml
<insert id ="insertMember" parameterType ="Member">
	INSERT INTO MEMBER
		VALUES(SEQ_UNO.NEXTVAL, #{userId}, #{userPwd}, #{userName}, #{email},
				#{birthday}, #{gender}, #{phone}, #{address}, SYSDATE, SYSDATE, DEFAULT)
  
  </insert>
```

**[ MemberServiceImpl.xml ]**

```java
@Override
	public void insertMember(Member m) throws Exception {
		SqlSession sqlSession = getSqlSession();

		int result = memberDao.insertMember(sqlSession, m);
		
		if(result > 0) {
			sqlSession.commit();
		}else {
			sqlSession.rollback();
			throw new Exception();
		}
		sqlSession.close();	
	}
```

**[ MemberInsertServlet.java ]**

```java
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

		String userId = request.getParameter("userId");
		String userPwd = request.getParameter("userPwd");
		String userName = request.getParameter("userName");
		String email = request.getParameter("email");
		String birthday = request.getParameter("birthday");
		String gender = request.getParameter("gender");
		String phone = request.getParameter("phone");
		String address = request.getParameter("address");
		
		Member m = new Member(userId, userPwd, userName, email, birthday, gender, phone, address);	
		try {
			memberService.insertMember(m);
			response.sendRedirect(request.getContextPath());

		} catch (Exception e) {

			request.setAttribute("msg", "íšŒì›ê°€ì… ì‹¤íŒ¨");
			request.getRequestDispatcher("WEB-INF/views/common/errorPage.jsp").forward(request, response);
			
			e.printStackTrace();
		}	
	}
```

# âš« ê²Œì‹œíŒ

## âœ”ï¸ board-mapper.xml ë“±ë¡

**[ mybatis-config.xml ]**

```xml

<typeAliases>
		<typeAlias type="com.kh.mybatis.member.model.vo.Member" alias="Member"/>
		<!-- Boardê°ì²´ ë³„ì¹­ ë“±ë¡ -->
		<typeAlias type="com.kh.mybatis.board.model.vo.Board" alias="Board"/> 
	</typeAliases>

<mappers>
		<mapper resource="/mappers/member-mapper.xml"/>
		<!-- board-mapperë¥¼ ë“±ë¡ -->
		<mapper resource="/mappers/board-mapper.xml"/>  
</mappers>

```

## âœ”ï¸ ê²Œì‹œíŒ ì¡°íšŒ- í˜ì´ì§•

### ğŸŒŸ ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ í˜ì´ì§• ê°ì²´ êµ¬í˜„

 * ***ì‹±ê¸€í†¤ íŒ¨í„´(Singleton Pattern)***

 *- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë  ë•Œ ì–´ë– í•œ í´ë˜ìŠ¤ëŠ” ìµœì´ˆ í•œë²ˆë§Œ **static**ìœ¼ë¡œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³  ê·¸ ë©”ëª¨ë¦¬ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì„ ë§í•œë‹¤.*

 *- JDBCTemplate , MyBatisTemplate ë“± ë“±ì— ì‚¬ìš©í•˜ë©°, ìƒì„±ìê°€ ì—¬ëŸ¬ ì°¨ë¡€ í˜¸ì¶œë˜ë”ë¼ë„ ì‹¤ì œë¡œ ìƒì„±ë˜ëŠ” ê°ì²´ëŠ” í•˜ë‚˜ì´ê³  ìµœì´ˆ ìƒì„± ì´í›„ í˜¸ì¶œëœ ìƒì„±ìê°€ ìµœì´ˆ ìƒì„±í•œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.*

*â‡’ **private**ë¡œ ì„ ì–¸í•œ í›„ **`getInstance()`**ë¡œ ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.* 

**[ PageInfo.java ]**

```java
package com.kh.mybatis.board.model.vo;

public class PageInfo {
	
	private int listCount;			// ì´ ê²Œì‹œê¸€ ê°¯ìˆ˜
	private int currentPage;		// í˜„ì¬ í˜ì´ì§€ (ì¦‰, ìš”ì²­í•œ í˜ì´ì§€)
	private int startPage;			// í˜„ì¬ í˜ì´ì§€ì— í•˜ë‹¨ì— ë³´ì—¬ì§€ëŠ” í˜ì´ì§• ë°”ì˜ ì‹œì‘ ìˆ˜ 
	private int endPage;			// í˜„ì¬ í˜ì´ì§€ì— í•˜ë‹¨ì— ë³´ì—¬ì§€ëŠ” í˜ì´ì§• ë°”ì˜ ë ìˆ˜
	private int maxPage;			// ì „ì²´ í˜ì´ì§€ì—ì„œì˜ ê°€ì¥ ë§ˆì§€ë§‰ í˜ì´ì§€
	
	private int pageLimit;			// í•œ í˜ì´ì§€ í•˜ë‹¨ì— ë³´ì—¬ì§ˆ í˜ì´ì§€ ìµœëŒ€ ê°¯ìˆ˜
	private int boardLimit;			// í•œ í˜ì´ì§€ì— ë³´ì—¬ì§ˆ ê²Œì‹œê¸€ ìµœëŒ€ ê°¯ìˆ˜

}
```

**[ Pagination.java ]**

```java
package com.kh.mybatis.common;

import com.kh.mybatis.board.model.vo.PageInfo;

public class Pagination {
	
	public static PageInfo getPageInfo(int listCount, int currentPage, int pageLimit, int boardLimit) {
		
		// * maxPage : ì´ í˜ì´ì§€ ìˆ˜
		
		int maxPage = (int)Math.ceil((double)listCount/boardLimit);
		
		// * startPage : í˜„ì¬ í˜ì´ì§€ì— ë³´ì—¬ì§€ëŠ” í˜ì´ì§• ë°”ì˜ ì‹œì‘ ìˆ˜
		int startPage = (currentPage - 1) / pageLimit * pageLimit + 1;
		
		// * endPage : í˜„ì¬ í˜ì´ì§€ì— ë³´ì—¬ì§€ëŠ” í˜ì´ì§• ë°”ì˜ ë ìˆ˜
		int endPage = startPage + pageLimit - 1;
		
		if(maxPage < endPage) {
			endPage = maxPage;
		}
		
		PageInfo pi = new PageInfo(listCount, currentPage, startPage, endPage, maxPage, pageLimit, boardLimit);
		return pi;
		
	}

}
```

**[ BoardListServlet.java ]**

- *`**int listCount = boardService.getListCount();**`*â†’ í˜ì´ì§• ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ ê²Œì‹œë¬¼ ê°¯ìˆ˜ì™€ í˜„ì¬ í˜ì´ì§€ ì •ë³´ê°€ í•„ìš”í•˜ë‹¤.
- `***PageInfo pi = Pagination.getPageInfo(listCount, currentPage, pageLimit, boardLimit);`***		
â†’ ì´ ê²Œì‹œë¬¼ ê°¯ìˆ˜ , í˜„ì¬ í˜ì´ì§€, í•œ í™”ë©´ì— í‘œì‹œë  í˜ì´ì§€ ìˆ˜ì™€ í‘œì‹œë  ê²Œì‹œë¬¼ ìˆ˜ë¥¼ ì…‹íŒ… í•´ì£¼ê³  `***getPageInfo`*** ë¥¼ í†µí•´ `***PageInfo***` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
- piê°ì²´ë¥¼ ë„˜ê²¨ Board ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê°ì²´ë¥¼ í˜¸ì¶œí•œë‹¤.

```java

@WebServlet("/list.bo")
public class BoardListServelt extends HttpServlet {
	private static final long serialVersionUID = 1L;
    private BoardService boardService = new BoardServiceImpl();
	
    /**
     * @see HttpServlet#HttpServlet()
     */
    public BoardListServelt() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		try {
			int listCount = boardService.getListCount();
			int currentPage = 1; //í˜„ì¬ í˜ì´ì§€
			int pageLimit = 10;
			int boardLimit = 5;
						
			if(request.getParameter("currentPage") != null) {
			currentPage = Integer.parseInt(request.getParameter("currentPage"));
			}

			PageInfo pi = Pagination.getPageInfo(listCount, currentPage, pageLimit, boardLimit);
			
			ArrayList<Board> list = boardService.selectList(pi);
			
			request.setAttribute("list", list);
			request.setAttribute("pi", pi);
			
			request.getRequestDispatcher("WEB-INF/views/board/boardListView.jsp").forward(request, response);

		} catch (Exception e) {
			e.printStackTrace();
		}
		
	}
```

### ğŸŒŸ ë§ˆì´ë°”í‹°ìŠ¤ì˜ í˜ì´ì§• ì²˜ë¦¬ - RowBounds

 * **RowBounds ê°€ ë¬´ì—‡ì¼ê¹Œ?** 

 - ***RowBounds***ëŠ” í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•´ ë§ˆì´ë°”í‹°ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ë¡œ íŠ¹ì • ê°¯ìˆ˜ë§Œí¼ ë ˆì½”ë“œë¥¼ ê±´ë„ˆë„ê²Œ í•´ì¤€ë‹¤. ***offset***ê³¼ ***limit***(ì´ ë ˆì½”ë“œ ìˆ˜)ë¡œ ìƒì„±í•œë‹¤.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8b4fdf14-cfad-4335-8714-5833c1727151/Untitled.png)

 â†’ ê°„ë‹¨íˆ ë§í•˜ìë©´ ***offset*** ë§Œí¼ ê±´ë„ˆë›´ ***limit***ë¥¼ ê°€ì ¸ì˜¨ë‹¤ê³  ë³´ë©´ëœë‹¤! ë‹¨, í…Œì´ë¸”ì„ *í’€ìŠ¤ìº”*ì„ í•œ í›„ ê±´ë„ˆë›°ì–´ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— *ë°ì´í„°ê°€ ë§¤ìš° ë§ì„ ê²½ìš°ì—ëŠ” ì†ë„ê°€ ì €í•˜*ë  ìˆ˜ ìˆë‹¤. 

 * **`*int offset*`** : ëª‡ê°œì˜ ê²Œì‹œê¸€ì„ ê±´ë„ˆ ë›°ê³  ì¡°íšŒí•  ì§€ì— ëŒ€í•´ ê³„ì‚°

		ex) **boardLimit : 5**
		 **currentPage** = **1**		**1~5**		*0ê°œì˜ ê²Œì‹œê¸€ ê±´ë„ˆ ë›°ê³  1ë¶€í„° 5ê°œ ì¡°íšŒ*
		 **currentPage** = **2**		**6~10**	*5ê°œì˜ ê²Œì‹œê¸€ ê±´ë„ˆ ë›°ê³  6ë¶€í„° 5ê°œ ì¡°íšŒ*
		 **currentPage** = **3**		**11~15**	*10ê°œì˜ ê²Œì‹œê¸€ ê±´ë„ˆ ë›°ê³  11ë¶€í„° 5ê°œ ì¡°íšŒ*
		 **currentPage** = **4**		**16~20**	*15ê°œì˜ ê²Œì‹œê¸€ ê±´ë„ˆ ë›°ê³  16ë¶€í„° 5ê°œ ì¡°íšŒ*

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e726523e-bd59-4eee-841f-257448a2d25c/Untitled.png)

**[ BoardDao.java ]**

```java
package com.kh.mybatis.board.model.dao;

import java.util.ArrayList;

import org.apache.ibatis.session.RowBounds;
import org.apache.ibatis.session.SqlSession;

import com.kh.mybatis.board.model.vo.Board;
import com.kh.mybatis.board.model.vo.PageInfo;

public class BoardDao {

	public int getListCount(SqlSession sqlSession) throws Exception {
		return sqlSession.selectOne("boardMapper.getListCount");
	}

	public ArrayList<Board> selectList(SqlSession sqlSession, PageInfo pi) throws Exception  {

		int offset = (pi.getCurrentPage()-1)* pi.getBoardLimit();
		
		RowBounds rowBounds = new RowBounds(offset, pi.getBoardLimit());

		return 	(ArrayList)sqlSession.selectList("boardMapper.selectList", null , rowBounds); //ë‘ë²ˆì§¸ ì¸ìëŠ” íŒŒë¼ë¯¸í„° íƒ€ì…ì´ë¯€ë¡œ ì„¸ë²ˆì§¸ ì¸ìë¡œ rowBoundsë¥¼ ë„˜ê¹€
	}

}
```

**[ board-mapper.xml ]**

â†’  resultMap ì„ ì‚¬ìš©í•´ select ê²°ê³¼ë¥¼ Boardê°ì²´ì— ë§¤í•‘í•œë‹¤. 

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">  
	
	<resultMap type="Board" id="boardResultMap">
	  	<id property="boardNo" column="BOARD_NO" />
	  	<id property="boardTitle" column="BOARD_TITLE" />
	  	<id property="boardWriter" column="USER_ID" />
	  	<id property="count" column="COUNT" />
	  	<id property="createDate" column="CREATE_DATE" />

	</resultMap>

<!-- ì´ ê²Œì‹œê¸€ ìˆ˜ë¥¼ ê°€ì ¸ì˜¨ -->
  <select id = "getListCount" resultType="_int">
		  
		  SELECT 
		  COUNT(*)
		  FROM BOARD
		  WHERE STATUS = 'Y'  
  </select>

  <select id="selectList" resultMap = "boardResultMap">
  
 		SELECT BOARD_NO, BOARD_TITLE, USER_ID, COUNT, CREATE_DATE
		FROM BOARD B
		JOIN MEMBER ON(BOARD_WRITER=USER_NO)
		WHERE B.STATUS='Y'
		ORDER BY BOARD_NO DESC
  
  </select>
</mapper>
```

**[ boardListView.jsp ]**

(Controller)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8059c8e7-337d-4642-a125-62dce5367ee2/Untitled.png)

â†’ í˜ì´ì§€ì˜ ì •ë³´ í‘œì‹œë¥¼ ìœ„í•´ PageInfo ì™€ Board ë¦¬ìŠ¤íŠ¸ë¥¼ ë‘˜ ë‹¤ requestì— setAttribute()ë¡œ  ë‹´ëŠ”ë‹¤.

```jsx
<!-- ê²Œì‹œë¬¼ë¦¬ìŠ¤íŠ¸ -->
		<table id="listArea" align="center">
			<thead>
				<tr>
					<th>ê¸€ë²ˆí˜¸</th>
					<th width="300">ì œëª©</th>
					<th>ì‘ì„±ì</th>
					<th>ì¡°íšŒìˆ˜</th>
					<th>ì‘ì„±ì¼</th>
				</tr>
			</thead>
			<tbody>
				<c:forEach var="b" items="${ list }">
					<tr>
						<td>${ b.boardNo }</td>
						<td>${ b.boardTitle }</td>
						<td>${ b.boardWriter }</td>
						<td>${ b.count }</td>
						<td>${ b.createDate }</td>
					</tr>
				</c:forEach>
			</tbody>
		</table>
<!-- í˜ì´ì§•ë°”ì˜ì—­ -->
		
		<div id="pagingArea" align="center">
			<!-- [ì´ì „] -->
			<c:if test="${ pi.currentPage != 1 }">
				<c:if test="${ empty search }">
						<a href="list.bo?currentPage=${ pi.currentPage-1 }">[ì´ì „]</a>
					</c:if>
					<c:if test="${ !empty search }">
						<c:url var="searchUrl" value="search.bo">
							<c:param name="currentPage" value="${pi.currentPage-1 }"/>
							<c:param name="condition" value="${ condition }"/>
							<c:param name="search" value="${ search }"/>
						</c:url>
						<a href="${ searchUrl }">[ì´ì „]</a>
					</c:if>
			</c:if>
			
			<!-- [ë²ˆí˜¸ë“¤] -->
			<c:forEach var="p" begin="${ pi.startPage }" end="${ pi.endPage }">
				<c:if test="${ pi.currentPage eq p }">
					<font color="red" size="4">[${ p }]</font>
				</c:if>
				<c:if test="${ pi.currentPage ne p }">
					<%-- <a href="list.bo?currentPage=${ p }">[${ p }]</a> --%>
					
					<c:if test="${ empty search }">
						<a href="list.bo?currentPage=${ p }">[${ p }]</a>
					</c:if>
					<c:if test="${ !empty search }">
						<c:url var="searchUrl" value="search.bo">
							<c:param name="currentPage" value="${ p }"/>
							<c:param name="condition" value="${ condition }"/>
							<c:param name="search" value="${ search }"/>
						</c:url>
						<a href="${ searchUrl }">[${ p }]</a>
					</c:if>
				</c:if>
			</c:forEach>
			
			<!-- [ë‹¤ìŒ] -->
			<c:if test="${ pi.currentPage ne pi.maxPage }">
				<c:if test="${ empty search }">
						<a href="list.bo?currentPage=${ pi.currentPage+1 }">[ë‹¤ìŒ]</a>
					</c:if>
					<c:if test="${ !empty search }">
						<c:url var="searchUrl" value="search.bo">
							<c:param name="currentPage" value="${pi.currentPage+1  }"/>
							<c:param name="condition" value="${ condition }"/>
							<c:param name="search" value="${ search }"/>
						</c:url>
						<a href="${ searchUrl }">[ë‹¤ìŒ]</a>
					</c:if>
			</c:if>
		</div>
```

# [ ê²°ê³¼ ]

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5c1c7b4f-d96d-49d5-bae4-7ff2b33d951a/Untitled.png)
