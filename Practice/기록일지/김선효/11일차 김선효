# âš« ë§ˆì´ë°”í‹°ìŠ¤ë€ ?

- ë°ì´í„°ì˜ CRUDë¥¼ ë³´ë‹¤ í¸í•˜ê¸°ìœ„í•´ xmlë¡œ êµ¬ì¡°í™”í•œ Mapper ì„¤ì •íŒŒì¼ì„ í†µí•´ JDBCë¥¼ êµ¬í˜„í•œ ì˜ì†ì„± í”„ë ˆì„ì›Œí¬
- ê¸°ì¡´ì— JDBCë¥¼ í†µí•´ êµ¬í˜„í–ˆë˜ ìƒë‹¹ ë¶€ë¶„ì˜ ì½”ë“œì™€ íŒŒë¼ë¯¸í„° ì„¤ì • ë° ê²°ê³¼ ë§¤í•‘ì„ XMLì„¤ì •ì„ í†µí•´ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

## â—¾ ë§ˆì´ë°”í‹°ìŠ¤ì˜ íë¦„

 - ì´ì „ì— *JDBC Template*ë¥¼ í†µí•´ *sql*ì„ ì‹¤í–‰í–ˆë‹¤ë©´ ë§ˆì´ë°”í‹°ìŠ¤ëŠ” í•´ë‹¹ íë¦„ì„ ì „ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ëŒ€ì²´ ì‘ìš©í•œë‹¤ê³  ë³´ë©´ëœë‹¤.

- **ì»¨íŠ¸ë¡¤ëŸ¬** > **ì„œë¹„ìŠ¤** > **DAO [ ë¥¼  ë§ˆì´ë°”í‹°ìŠ¤ ì„¤ì • íŒŒì¼ë¡œ ëŒ€ì²´  ]** > **DB**

*DAO*ì—ì„œëŠ” í˜¸ì¶œë§Œ í•˜ê²Œ ëœë‹¤.

## â—¾ë§ˆì´ë°”í‹°ìŠ¤ì˜ ë™ì‘ êµ¬ì¡°

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/13005a56-487c-4fab-a582-81270c8ae583/Untitled.png)

# âš« mybatis-config ì„¤ì •í•˜ê¸°

1. **í”„ë¡œì íŠ¸ì— *resources* í´ë” ì¶”ê°€** 

1. ***Java Build Path*ì—ì„œ *Add Folder* ë¡œ *resources* ë¥¼ ì¶”ê°€í•´ì£¼ë©´ *resources* í´ë”ë„ í´ë˜ìŠ¤íŒ¨ìŠ¤ë¡œ ì¡íŒë‹¤.**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8bfcbc99-03bc-457f-af20-4e51b4c3c00e/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6cf4cfe7-ab9d-4005-b0ae-5ff168100d7f/Untitled.png)

## âœ”ï¸ DTD(ë¬¸ì„œ í˜•ì‹ ì •ì˜) ì¶”ê°€í•˜ê¸°

â†’ ë§ˆì´ë°”í‹°ìŠ¤ API ì‚¬ì´íŠ¸ì—ì„œ ì œê³µí•˜ê³  ìˆëŠ” mapperì™€ config ë¥¼ ë¬¸ì„œí˜•ì‹ìœ¼ë¡œ ì •ì˜í•´ì„œ xmlíŒŒì¼ì„ ìƒì„±í•  ë•Œ ìë™ìœ¼ë¡œ í˜•ì‹ì„ ê°–ì¶œ ìˆ˜ ìˆê²Œ í•œë‹¤. ë‹¨, ì¸í„°ë„·ì´ ì•ˆ ë  ê²½ìš°ì—ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ê³  í•œë‹¤.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/52f2db51-a30d-44f3-be4a-619f01668744/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6449e2b6-41a4-4eb0-94ae-bd388029ac79/Untitled.png)

â†’ ***Add í´ë¦­í•˜ê³  ì•„ë˜ ë‘ ê°œ ì…ë ¥ í›„ OK !***

**[ config ]**

- **Location :**   [http://mybatis.org/dtd/mybatis-3-config.dtd](http://mybatis.org/dtd/mybatis-3-config.dtd)
- **Key :**   -[//mybatis.org//DTD](https://mybatis.org//DTD) Config 3.0//EN
****

**[ mapper]**

- **Location :**   [http://mybatis.org/dtd/mybatis-3-mapper.dtd](http://mybatis.org/dtd/mybatis-3-mapper.dtd)
- **Key :**   -[//mybatis.org//DTD](https://mybatis.org//DTD) Mapper 3.0//EN
****

â†’ ***Apply and close í´ë¦­ í•˜ë©´ ì™„ë£Œ !***

*ì´ëŸ° ë°©ë²•ë„ ìˆê³  ë”°ë¡œ ë‹¤ìš´ë°›ì•„ì„œ ë„£ì–´ì£¼ëŠ” ë°©ë²•ë„ ìˆë‹¤ê³  í•œë‹¤.

## âœ”ï¸ mybatis-config.xml ì‘ì„±

**[ mybatis-config.xml ]**

```xml
<!-- xml ìµœìƒë‹¨ì— xmlí˜•ì‹ì„ ì§€ì •í•˜ì—¬ ì´í•˜ì˜ ì„¤ì • ë‚´ìš©ì´ mybatis config ì„¤ì •ì„ì„ ì„ ì–¸ -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd" >

<!-- configuration : ë§ˆì´ë°”í‹°ìŠ¤ ì„¤ì •ê³¼ ê´€ë ¨ëœ ê¸°ë³¸ ì…‹íŒ…ë“¤ì„ ì„ ì–¸í•  ìˆ˜ ìˆëŠ” ì˜ì—­. ë‚´ë¶€ì— ì‘ì„±í•˜ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ë“¤ì˜ ìˆœì„œê°€ ì¤‘ìš”  -->

<configuration>

	<!-- ë°ì´í„°ê°€ Nullë¡œ ë“¤ì–´ì˜¬ ê²½ìš° ë¹ˆì¹¸ì´ ì•„ë‹Œ nullë¡œ ì¸ì‹í•˜ë„ë¡ ì„¤ì •   / valueì— nullì„ ëŒ€ë¬¸ìë¡œ ê¸°ì…í•´ì•¼ í•¨-->
	<settings>
		<setting name="jdbcTypeForNull" value="NULL"/>
	</settings>
	
	<!-- VO/DTD ê°ì²´ì˜ í’€íŒ¨í‚¤ì§€ëª…ì„ ì¼ë°˜ í´ë˜ìŠ¤ëª…ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë³„ì¹­ì„ ì„ ì–¸í•˜ëŠ” íƒœê·¸  -->
	<typeAliases>
		<typeAlias type="package com.kh.mybatis.member.model.vo.Member" alias="Member" />
	</typeAliases>
	
	<!-- DB ì—°ê²° ì„¤ì •  -->
	<environments default="development">
	    <environment id="development">
	      <transactionManager type="JDBC"/>
	      <dataSource type="POOLED">
	        <property name="driver" value="oracle.jdbc.driver.OracleDriver"/>
	        <property name="url" value="jdbc:oracle:thin:@localhost:1521:xe"/>
	        <property name="username" value="mybatis"/>
	        <property name="password" value="mybatis"/>
	      </dataSource>
	    </environment>
	 </environments>
</configuration>
```

### â—¾ config íƒœê·¸ ì •ë¦¬

- * **`<configuration>` : ìµœìƒìœ„ íƒœê·¸ë¡œ ë‚´ë¶€ì— í•„ìš”í•œ ì„¤ì •ì„ ì‘ì„±**
    
    ```xml
    <configuration>
    	
    	<!-- ë‚´ë¶€ì— ì„¤ì • ì‘ì„± -->
    
    </configuration>
    ```
    
- * **`<properties>`** **: ì™¸ë¶€ properties íŒŒì¼ì˜ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ ë•Œ ì‚¬ìš©í•˜ëŠ” íƒœê·¸**
    
    
    ```xml
    <properties resource="ê²½ë¡œ + íŒŒì¼ëª….properties">
    		<!-- properties íŒŒì¼ì— ê°’ì„ ì„¤ì • ê°€ëŠ¥  -->
    		<property name="keyëª…" value="ì„¤ì • ê°’"/>
    </properties>
    
    <!-- ì„¤ì • ê°’ í™œìš©-->
    <dataSource type="POOLED">
    		<property name="ëª…ì¹­" value="${ propertiesì— ì„¤ì • ëœ keyëª…}"/>
    		<property name="ëª…ì¹­" value="${ propertiesì— ì„¤ì • ëœ keyëª…}"/>
    </dataSource>
    
    ```
    
- * **`<settings>` : mybatis êµ¬ë™ ì‹œ ì„ ì–¸í•  ì„¤ì •ë“¤ì„ ì‘ì„±í•˜ëŠ” íƒœê·¸**
    
    
    ```xml
    <!-- ë§Œì•½ì— Null ë¡œ ë°ì´í„° ë“¤ì–´ì˜¤ë©´ ë¹ˆì¹¸ì´ì•„ë‹ˆê³  null ë¡œ ì¸ì‹ í•˜ë„ë¡ ì„¤ì • -->
    <settings>
    		<setting name="jdbcTypeForNull" value="NULL"/>
    </settings>
    ```
    
    [MyBatis - ë§ˆì´ë°”í‹°ìŠ¤ 3 | ë§¤í¼ ì„¤ì •](https://mybatis.org/mybatis-3/ko/configuration.html)
    
- *** `<typeAliasese>` : mybatisì—ì„œ ì‚¬ìš©í•  ìë£Œí˜•ì˜ ë³„ì¹­ì„ ì„ ì–¸í•˜ëŠ” íƒœê·¸**
    
    
    â†’ ì§€ì •í•´ì¤€ ë³„ì¹­ìœ¼ë¡œ ë§¤í¼.xmlì—ì„œ ì‚¬ìš©í•  ë•Œ í•´ë‹¹ ë³„ì¹­ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ëª…ì‹œê°€ ì•ˆë˜ì–´ìˆìœ¼ë©´ í’€íŒ¨í‚¤ì§€ëª…ìœ¼ë¡œ ì ì–´ì¤˜ì•¼ í•œë‹¤.
    
    ```xml
    <!-- VO/DTO ê°ì²´ì˜ í’€ë„¤ì„ì„ ì¼ë°˜ í´ë˜ìŠ¤ëª…ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°ìœ„í•´ ë³„ì¹­ì„ ì–¸ -->
    	<typeAliases>
    			<typeAlias type="com.kh.mybatis.member.model.vo.Member" alias="Member"/>
    	</typeAliases>
    ```
    
- *** `<environments>` : mybatisì—ì„œ ì—°ë™í•  DB ì •ë³´ë¥¼ ë“±ë¡í•˜ëŠ” íƒœê·¸**
    
    â†’ ì—¬ëŸ¬ ê°œë„ ì§€ì • ê°€ëŠ¥í•˜ë‹¤.
    
    ```xml
    <!-- DB ì—°ê²° ì„¤ì • -->
    	 <environments default="development">
    	    <environment id="development">
    	      <transactionManager type="JDBC"/>
    	      <dataSource type="POOLED">
    	        <property name="driver" value="oracle.jdbc.driver.OracleDriver"/>
    	        <property name="url" value="jdbc:oracle:thin:@localhost:1521:xe"/>
    	        <property name="username" value="mybatis"/>
    	        <property name="password" value="mybatis"/>
    	      </dataSource>
    	    </environment>
    	  </environments>
    ```
    
- ***`<mappers>` íƒœê·¸ : ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ì¿¼ë¦¬ë¬¸ì´ ì •ì˜ëœ mapper íŒŒì¼ì„ ë“±ë¡í•˜ëŠ” íƒœê·¸**
    
    ```xml
    <!-- DBì— ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ë¬¸ì„ ë‹´ì€ mapper íŒŒì¼ì„ ë“±ë¡ -->
    	<mappers>
    		<mapper resource="/mappers/member-mapper.xml"/>
    	</mappers>
    ```
    

### ğŸŒŸ POOLEDì™€ UNPOOLEDì˜ ì°¨ì´ì 

- ***POOLED*** : ìµœì´ˆ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ í•´ë‹¹ ì •ë³´ë¥¼ *pool*ì˜ì—­ì— ì €ì¥í•´ë‘ê³  ì´í›„ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ì´ë¥¼ ì¬ì‚¬ìš©í•œë‹¤.
    - **ì¥ì ** :  *Connection* ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ *DB*ì™€ ì—°ê²°ì„ êµ¬ì¶•í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ë‹¨ì¶•
    - **ë‹¨ì ** : ì„¤ì •ì´ ë§ì•„ ë‹¨ìˆœí•œ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ê¸°ì—ëŠ” ë¶€ì í•©
- ***UNPOOLED***: ê°ì²´ë¥¼ ë³„ë„ë¡œ ì €ì¥í•˜ì§€ ì•Šê³  í˜¸ì¶œ ì‹œ ë§¤ë²ˆ ìƒì„±í•œë‹¤
    - **ì¥ì **: *Connection* ì—°ê²°ì´ ë§ì§€ ì•Šì€ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„ ê°€ëŠ¥
    - **ë‹¨ì **: ë§¤ë²ˆ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ë¯€ë¡œ ì†ë„ê°€ ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼

 * *ì„¤ì • ê°€ëŠ¥í•œ type ì¤‘ JNDLë„ ìˆëŠ”ë°, ì´ëŠ” mybatisì—ì„œ Connection ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ê´€ë¦¬í•˜ì§€ ì•Šê³  Web Application ì˜ ì„¤ì •ì„ ë”°ë¥´ê² ë‹¤ëŠ” ì˜ë¯¸* 

### ğŸŒŸ  Mybatis ë‚´ì¥ ë³„ì¹­ (for parameterType / resultType)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e1d31807-9b0d-433a-969e-efdf6a2b09d0/Untitled.png)

# âš« mapper ì„¤ì •í•˜ê¸°

## âœ”ï¸ -mapper.xml ì‘ì„±

*â†’ '**resources**' í´ë” ì•ˆì— **mappers** í´ë”ë¥¼ ìƒì„±í•˜ê³  ê·¸ ì•ˆì— ì‹ë³„í•˜ê¸° ì‰¬ìš´ ì´ë¦„ì„ ì§€ì–´ íŒŒì¼ì„ ë“±ë¡*

â†’ xmlìµœìƒë‹¨ì— ë‹¤ìŒê³¼ ê°™ì´ xml í˜•ì‹ì„ ì§€ì •í•˜ì—¬ ì´í•˜ì˜ ì„¤ì •ë‚´ìš©ì´ ë§ˆì´ë°”í‹°ìŠ¤ì˜ ë§¤í¼ ì„¤ì •ì„ì„ ì„ ì–¸

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1ac560ba-463b-44b9-9d11-f9229f2491f2/Untitled.png)

â†’ ì´ì–´ì„œ ìµœìƒìœ„ì— **<mapper>** íƒœê·¸ë¥¼ ì‘ì„±í•˜ê³ , ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì´ë¦„ì¸ ***namespace***ì†ì„±ì„ ê¼­ ê¸°ì…í•œë‹¤.  ì´í›„ íƒœê·¸ëŠ” **<mapper>** ë‚´ë¶€ì— ì‘ì„± 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/626077c9-d945-4731-be64-3f5bb19263e6/Untitled.png)

### â—¾ mapper íƒœê·¸ ì •ë¦¬

 **[ member-mapper.xml ]**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">
 
  
 <!--  USER_IDì™€ USER_PWD ì»¬ëŸ¼ì€ Member ê°ì²´ì˜ í•„ë“œ ë³€ìˆ˜ëª…ê³¼ ì¼ì¹˜í•˜ì§€ ì•Šì•„ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•œë‹¤. -->
    <resultMap type="Member" id="memberResultSet">
	  	<id property="userNo" column="USER_NO" />
	  	<id property="userId" column="USER_ID" />
	  	<id property="userPwd" column="USER_PWD" />
	  	<id property="userName" column="USER_NAME" />
	  	<id property="email" column="EMAIL" />
	  	<id property="birthday" column="BIRTHDAY" />
	  	<id property="gender" column="GENDER" />
	  	<id property="phone" column="PHONE" />
	  	<id property="address" column="ADDRESS" />
	  	<id property="enrollDate" column="ENROLL_DATE" />
	  	<id property="modifyDate" column="MODIFY_DATE" />
	  	<id property="status" column="STATUS" />  	
  </resultMap>

  <!-- <select id = "loginMember" parameterType="Member" resultType="Member"> -->
  
  <select id = "loginMember" parameterType="Member" resultMap="memberResultSet">
  	SELECT * 
  	FROM MEMBER
  	WHERE USER_ID = #{userId}
  	AND USER_PWD = #{userPwd}
  	AND STATUS='Y'
  
  </select>

</mapper>
```

- **`<resultMap>`** :  ì¡°íšŒí•œ ê²°ê³¼ë¥¼ ê°ì²´ì™€ Rowê°„ì˜ 1:1ë§¤ì¹­ì´ ì•„ë‹Œ, ì›í•˜ëŠ” ê°ì²´ì˜ í•„ë“œì— ë‹´ì•„ ë°˜í™˜í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•˜ëŠ” íƒœê·¸
    - ***type ì†ì„±*** : ì‹¤ì œë¡œ êµ¬í˜„í•´ë†“ì€ ìë°” POJO ê°ì²´ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ë©°, mybatis-config.xmlì—ì„œ *typeAlias*(ë³„ì¹­) ì„ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” í’€íŒ¨í‚¤ì§€ëª…ìœ¼ë¡œ ê¸°ì…í•´ì•¼ í•¨.
    - ***property*** = ìë°”ì˜ í•„ë“œ ë³€ìˆ˜ ì´ë¦„ / ***column*** = DBì˜ í•´ë‹¹ ì»¬ëŸ¼
        
        â†’ ë³€ìˆ˜ëª…ê³¼ ì»¬ëŸ¼ëª…ì´ ë‹¤ë¥¼ ì‹œ ì´ë ‡ê²Œ ì§€ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ë‹¤. ë°˜ëŒ€ë¡œ ê°™ë‹¤ë©´ ì„¤ì •ì„ í•´ì£¼ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ ê°’ì„ ê°€ì ¸ì˜´ì„ ì˜ë¯¸í•œë‹¤.
        
    - ***id*** : ê¸°ë³¸ í‚¤ ì»¬ëŸ¼
    - ***result*** : ì¼ë°˜ ì»¬ëŸ¼
    
    ```xml
    <resultMap type="Member" id="memberResultSet">
    	  	<id property="userNo" column="USER_NO" />
    	  	<result property="userId" column="USER_ID" />
    	  	<result property="userPwd" column="USER_PWD" />
    	  	<result property="modifyDate" column="MODIFY_DATE" />
    	  	<result property="status" column="STATUS" />  	
      </resultMap>
    ```
    
- **`<select>`** : SQL ì˜ ì¡°íšŒ êµ¬ë¬¸ì„ ì‘ì„±í•  ë•Œ ì‚¬ìš©ë˜ëŠ” íƒœê·¸
    
    *â†’ í•´ë‹¹ ì¿¼ë¦¬ë¥¼ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ê³ ì í•  ë•Œ [namespace.id](http://namespace.id) ëª…ì„ ì ‘ì–´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.*
    
    â†’ **`#{}`**ëŠ” ***PreparedStatement*** ì˜  ' **?** ' ì™€ ê°™ì€ ì—­í• ì´ë©°, ì „ë‹¬ ëœ ê°’ì„ ëœ»í•œë‹¤. ì—¬ëŸ¬ ì¤„ë¡œ ì¤„ë°”ê¿ˆì„ í•˜ì—¬ ì‚¬ìš©ë„ ê°€ëŠ¥í•˜ë‚˜ *ì„¸ë¯¸ì½œë¡ ì€ ì œì™¸ (ì—ëŸ¬ ìœ ë°œ)*í•œë‹¤. 
    
    ```xml
    <select id = "loginMember" parameterType="Member" resultMap="memberResultSet">
      	SELECT * 
      	FROM MEMBER
      	WHERE USER_ID = #{userId}
      	AND USER_PWD = #{userPwd}
      	AND STATUS='Y'
      
      </select>
    ```
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3ecaeb7e-f268-4465-a214-66f67192dab0/Untitled.png)
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9aacfaf8-73af-4eb6-9087-f31167ee0b7a/Untitled.png)
    
    ### ğŸŒŸ FlushCache ì™€ useCache
    
     *- ë‚´ìš©ì˜ ë³€ë™ì´ ì—†ëŠ” ì •ì ì¸ ê²°ê³¼ë‚˜ ì¿¼ë¦¬ëŠ” ë°˜ë³µ ì‹œë§ˆë‹¤ êµ³ì´ ìƒˆë¡œìš´ ì¿¼ë¦¬ë¡œ ìƒì„±í•˜ì—¬ í˜¸ì¶œí•˜ê±°ë‚˜, ìƒˆë¡œìš´ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¬ í•„ìš”ê°€ ì—†ë‹¤. ì´ëŸ¬í•œ ìƒí™©ì„ ìœ„í•´ **Mybatisì—ì„œ ë‚´ì¥í•˜ê³  ìˆëŠ” Cache ì €ì¥ì†Œì— ë°˜ë³µë˜ëŠ” ì •ì ì¸ ì¿¼ë¦¬ì˜ í˜¸ì¶œì´ë‚˜ ê²°ê³¼ë¥¼ í•œ ë²ˆ ì´ìƒ ì‹¤í–‰í•  ê²½ìš° ë¯¸ë¦¬ ì €ì¥ì‹œì¼œë‘ê³  ì¬ í˜¸ì¶œ**ì— ì†Œìš”ë˜ëŠ” ì‹œê°„ì„ ì ˆì•½ì‹œì¼œì¤€ë‹¤.* 
    

- **`<insert>` , `<update>` , `<delete>`**
    
    
     * **ì„¸ íƒœê·¸ëŠ”** **ì£¼ìš” ì†ì„±ì´ ë™ì¼í•˜ë‹¤.**
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d325851a-a436-4dfb-91bc-848c851d490b/Untitled.png)
    

# âš« SqlSession ìƒì„±í•˜ê¸°

## âœ”ï¸ ì‹±ê¸€í†¤ì„ ì ìš©í•œ Template í´ë˜ìŠ¤ ìƒì„±

### â–ªï¸ SqlSessionFactory ë¥¼ ë¹Œë“œí•˜ê³  SqlSessionì„ ë°˜í™˜í•˜ëŠ” Templateì„ ìƒì„±

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/13e621fd-93d0-4cdb-8fdb-0ef0ac1227d9/Untitled.png)

**[ Template.java ]**

```java
package com.kh.mybatis.common;

import java.io.IOException;
import java.io.InputStream;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

public class Template {
	
	public static SqlSession getSqlSession() {
		
		SqlSession sqlSession = null;
		
		InputStream stream;
		try {
			stream = Resources.getResourceAsStream("/mybatis-config.xml");
			sqlSession = new SqlSessionFactoryBuilder().build(stream).openSession(false); //default ê°€ falseì„

		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return sqlSession;
		
	}

}
```

### ğŸŒŸ SqlSessionFactoryBuilder ë©”ì†Œë“œ

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f4ab487f-d56d-4738-ac21-12457dace91b/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/097a654d-6c10-4cc1-a7cb-f97992677fd8/Untitled.png)

### â–ªï¸ ì„œë¸”ë¦¿ë§ˆë‹¤ ê³µí†µì ì¸ ì¸ì½”ë”© ì²˜ë¦¬ë¥¼ ìœ„í•œ ì¸ì½”ë”© í•„í„° ì¶”ê°€

- **[ EncodingFilter.java ]**
    
    ```java
    package com.kh.mybatis.common.filter;
    
    import java.io.IOException;
    import javax.servlet.Filter;
    import javax.servlet.FilterChain;
    import javax.servlet.FilterConfig;
    import javax.servlet.ServletException;
    import javax.servlet.ServletRequest;
    import javax.servlet.ServletResponse;
    import javax.servlet.annotation.WebFilter;
    
    /**
     * Servlet Filter implementation class EncodingFilter
     */
    @WebFilter(urlPatterns="/*")
    public class EncodingFilter implements Filter {
    
        /**
         * Default constructor. 
         */
        public EncodingFilter() {
            // TODO Auto-generated constructor stub
        }
    
    	/**
    	 * @see Filter#destroy()
    	 */
    	public void destroy() {
    		// TODO Auto-generated method stub
    	}
    
    	/**
    	 * @see Filter#doFilter(ServletRequest, ServletResponse, FilterChain)
    	 */
    	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
    		// ë·°ì—ì„œ ì „ë‹¬ ë°›ì€ ê°’ì— í•œê¸€ì´ ìˆì„ ê²½ìš°
    		request.setCharacterEncoding("utf-8");
    		
    		chain.doFilter(request, response);
    	}
    
    	/**
    	 * @see Filter#init(FilterConfig)
    	 */
    	public void init(FilterConfig fConfig) throws ServletException {
    		// TODO Auto-generated method stub
    	}
    
    }
    ```
    

### â–ªï¸SqlSessionì„ í†µí•œ ì¿¼ë¦¬ ì‹¤í–‰

**[ VIEW ]**

```jsx
<form action="login.me" method="post">
	ì•„ì´ë””  : <input type="text" name="userId">
	ë¹„ë°€ë²ˆí˜¸ : <input type="password" name="userPwd">
</form>
```

**[ LoginServlet.java ]**

```java
package com.kh.mybatis.member.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.kh.mybatis.member.model.service.MemberService;
import com.kh.mybatis.member.model.service.MemberServiceImpl;
import com.kh.mybatis.member.model.vo.Member;

@WebServlet("/login.me")
public class LoginServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
	
	private MemberService memberService = new MemberServiceImpl();
	
    public LoginServlet() {
        super();
    }

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		String userId = request.getParameter("userId");
		String userPwd = request.getParameter("userPwd");
		
		Member m = new Member();
		m.setUserId(userId);
		m.setUserPwd(userPwd);
		
		Member loginUser = memberService.loginMember(m);

		System.out.println(loginUser);
		
	}
****	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}
****
}
```

**[ MemberService.java ] - Mapper Interface** 

```java
package com.kh.mybatis.member.model.service;

import com.kh.mybatis.member.model.vo.Member;

public interface MemberService {

	Member loginMember(Member m);

}
```

  * ì¸í„°í˜ì´ìŠ¤ë¡œ ***ë°˜í™˜íƒ€ì…*** ê³¼ ***íŒŒë¼ë¯¸í„° íƒ€ì…***ì„ ì •ì˜í•´ë†“ê³  ì‚¬ìš©í•˜ëŠ” ì´ìœ  *

â†’ *ê¸°ì¡´ ë°©ì‹ì²˜ëŸ¼ **`new MemberService().loginMember()`**ì™€ ê°™ì€ í˜•íƒœë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ê²°í•©ë„ë¥¼ ë‚®ì¶”ê¸° ìœ„í•¨ì´ë‹¤. ëª¨ë“ˆê³¼ ëª¨ë“ˆì€ ê´€ë ¨ ì •ë³´ê°€ ë§ì„ ìˆ˜ë¡ ê²°í•©ë„ê°€ ë†’ì•„ì§€ëŠ”ë° ê²°í•©ë„ê°€ ë†’ì•„ì§€ë©´ ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ê¸° ë•Œë¬¸ì— ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” í˜•íƒœê°€ ë§ë‹¤. ì ˆëŒ€ì ì¸ ë°©ì‹ì€ ì•„ë‹ˆê³  íšŒì‚¬ì˜ í™˜ê²½ë§ˆë‹¤ ì°¨ì´ëŠ” ìˆì„ ìˆ˜ ìˆë‹¤.*

**[ MemberServiceImpl.java ]**

```java
package com.kh.mybatis.member.model.service;

import org.apache.ibatis.session.SqlSession;
import static com.kh.mybatis.common.Template.*;
import com.kh.mybatis.member.model.vo.Member;
import com.kh.mybatis.member.model.dao.MemberDao;
public class MemberServiceImpl implements MemberService {

	private MemberDao memberDao = new MemberDao();
	
	@Override
	public Member loginMember(Member m) {
		SqlSession sqlSession = getSqlSession();

		Member loginUser = memberDao.loginMember(sqlSession, m);
		
		sqlSession.close();
		return loginUser;
	}

}
```

â†’ ***`getSqlSession()`*** í˜¸ì¶œì„ í†µí•´ ***SqlSession***ì„ ìƒì„±

â†’***Dao***í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œ í˜¸ì¶œ ì‹œ ì¸ìë¡œ ***SqlSession*** ê°ì²´ë¥¼ ë„˜ê¸´ë‹¤. 

â†’ **JDBCTemplate.java**ì—ì„œ *static*ìœ¼ë¡œ ***Connection*** ê°ì²´ ìƒì„±í•˜ì—¬ ë°˜í™˜í•˜ë˜ ***`getConnection()`*** ìœ¼ë¡œ ***Connection*** ìƒì„±í•´ì„œ ë„˜ê²¨ì¤¬ë˜ ê²ƒ ê³¼ ê°™ì€ ì›ë¦¬ì„. 

**[ [MemberDao.java](http://MemberDao.java) ]**

```java
package com.kh.mybatis.member.model.dao;

import org.apache.ibatis.session.SqlSession;
import com.kh.mybatis.member.model.vo.Member;

public class MemberDao {

	public Member loginMember(SqlSession sqlSession, Member m) {
		
		Member loginUser = null;
		
		loginUser = sqlSession.selectOne("memberMapper.loginMember", m);

		return loginUser;
	}

}
```

â†’ **m** ê°ì²´ë¥¼ ***memberMapper*** ë§¤í¼ì— ***loginMember*** ê°€ ***id***ì¸ ê²ƒì„ ì°¾ì•„ê°€ì„œ ë„˜ê²¨ì£¼ê³  ***sql***ì„ ì‹¤í–‰ì‹œì¼œ ***Member***ê°ì²´ë¥¼ ë°›ì•„ì˜¨ë‹¤.

### ğŸŒŸ SqlSessionì„ í†µí•œ ì¿¼ë¦¬ì‹¤í–‰ ë©”ì†Œë“œ

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d675aa8e-7e1d-4fbf-b29f-ebff7697e06b/Untitled.png)

### ì‹¤í–‰

**ì…ë ¥í•œ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ  Memberê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì´ ê°ì²´ë¥¼ ì¸ìë¡œ ì „ë‹¬í•˜ì—¬ SQLì´ ì‹¤í–‰ëœë‹¤.** 

**DBì—ì„œ ì¡°íšŒ ëœ ê²°ê³¼ë¥¼ ë‹¤ì‹œ Member ê°ì²´ë¡œ ë°˜í™˜í•œë‹¤.**

- ì„œë¸”ë¦¿ì—ì„œ requestì˜ íŒŒë¼ë¯¸í„°ë¡œ Member ê°ì²´ ìƒì„±
- íŒŒë¼ë¯¸í„° íƒ€ì…ê³¼ ë¦¬í„´ íƒ€ì…ì„ ì¸í„°í˜ì´ìŠ¤ë¡œ ì§€ì • â†’ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ì—¬ ë©”ì†Œë“œ ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬ ìƒì„±í•œ í´ë˜ìŠ¤ì— Memberê°ì²´ì™€ SqlSession ì¸ìë¡œë„˜ê¸°ë©°  DAOí˜¸ì¶œ í›„ì— SqlSessionì€ ë‹«ì•„ì¤Œ
- DAO í˜¸ì¶œ â†’ DAO ì—ì„œ sqlSession.selectOne("memberMapper.loginMember", m) ì‹¤í–‰ì‹œì¼œ ë°˜í™˜

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/604d60cf-503a-4e0d-8ce7-d84bd4f2dc81/Untitled.png)
