â†’***ëŒ€ëŒ“ê¸€ UI êµ¬í˜„ ì¤‘ ìƒê°ë³´ë‹¤ ë§‰íˆëŠ” ë¶€ë¶„ì´ ë§ì•„ì„œ ê¸°ëŠ¥ì ì¸ ë¶€ë¶„ì—ì„œëŠ” ì˜¤ëŠ˜ í¬ê²Œ ì§„ë„ë¥¼ ë‚˜ê°€ì§€ ëª»í•œ ê²ƒ ê°™ë‹¤. í•˜ì§€ë§Œ ì¼ë°˜ ëŒ“ê¸€ CRUDëŠ” ëª¨ë‘ ëë‚¬ê³  ëŒ€ëŒ“ê¸€ì€ ì¡°íšŒë§Œ ë‚¨ê²¨ë‘” ìƒíƒœë¼ ë‚´ì¼ê¹Œì§€ ë§ˆë¬´ë¦¬í•˜ë©´ ë  ê²ƒ ê°™ë‹¤!*** 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/58a15c82-96ad-4327-ac7d-8f04d1eb7575/Untitled.png)

# â™£ï¸ SQL

```sql
//1. ìµëª… ëŒ“ê¸€ ë“±ë¡
INSERT INTO E_COMMENT VALUES(SEQ_E_COMMENT.NEXTVAL,?,?,?,SYSDATE,?,?)

//2. ë¡œê·¸ì¸ ìœ ì € ëŒ“ê¸€ ë“±ë¡
INSERT INTO E_COMMENT VALUES(SEQ_E_COMMENT.NEXTVAL,?,?,NULL,SYSDATE,?,?)
```

# âœ”ï¸ ëŒ€ëŒ“ê¸€ ë“±ë¡

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/87863b49-ed8b-496b-b399-ef07c2942119/Untitled.png)

**â†’ ë‹µê¸€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë‹µê¸€ ì‘ì„±ë€ì´ ìƒê¸´ë‹¤ ! ë‹«ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì‚­ì œ**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/94e087ea-0071-4ed9-96a1-3816066e224d/Untitled.png)

## âš« JSP

## <ì…ë ¥ì°½ UI ë™ì  êµ¬í˜„>

- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ajaxì˜  `**success : function()**` ì— ìœ„ì¹˜í•˜ëŠ” ì½”ë“œì´ë‹¤.
- **`$(this).next().next().after(` `)` :  í´ë¦­í•œ ê°ì²´ì˜ ë‹¤ìŒ(ìˆ˜ì •ë²„íŠ¼),ë‹¤ìŒ(X)ê°ì²´ ë’¤ì— htmlíƒœê·¸ë¥¼ ì‚½ì…í•˜ì—¬ UIë¥¼ ìƒì„±í•œë‹¤.**

### eventDetailView.jsp

```jsx
$(".nestedComment").on("click",function(){  //ë‹µê¸€ ë²„íŠ¼ í´ë¦­!!
					
 					$(this).next().next().after(`
 							<div class="replyBox">
							<br>
							<form method="post" action="<%=request.getContextPath()%>/enrollReComment.ev">
							<input type="hidden" name="eno" value="<%=e.geteNo()%>">
									<h5>ë‹µê¸€ ì‘ì„± </h5>
							<%
								if (loginUser != null) {
							%>
							<input type="hidden" name="emailId"
								value="<%=loginUser.getEmailId()%>">
							<%
								} else {
							%>
							ë‹‰ë„¤ì„ : <input type="text" name="nickname">
							ë¹„ë°€ë²ˆí˜¸ : <input type="password" name="cPwd" maxLength="6">

							<%
								}
							%>
				
							<textarea name="comment" class="comment"
								maxlength="1000" > </textarea>
				
							<input type="submit" id="commentBtn" value="ëŒ“ê¸€ ë“±ë¡" >
							<input type="button" value="ë‹«ê¸°" onclick="removeReplyBox();">
							</form>
							</div>
							`) 

				})
```

- `**<input type="button" value="ë‹«ê¸°" onclick="removeReplyBox();">**` : ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ **ì „ì—­í•¨ìˆ˜** ë¡œ ì„ ì–¸í•´ ë‘” **`removeReplyBox()`** ë¥¼ í†µí•´ ì…ë ¥ì°½ì´ ì‚­ì œëœë‹¤.

â†’ *ì²˜ìŒì—ëŠ” í•¨ìˆ˜ë¥¼ ê°™ì€ ë²”ìœ„ ë‚´ì— ì •ì˜í•´ë‘ì—ˆëŠ”ë° í´ë¦­ ì´ë²¤íŠ¸ê°€ íƒ€ì§€ ì•Šì•„ ë°–ìœ¼ë¡œ ì˜®ê²¨ë³´ë‹ˆ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì‹œì ì—ì„œ ìƒì„±ë˜ì–´ ì•ˆ íƒ€ì§€ëŠ” ê²ƒì´ì—ˆì„ê¹Œ ì¼ë‹¨ ì¶”ì¸¡ë§Œì´ ê°€ëŠ¥í–ˆì§€ë§Œ ì „ì—­ìœ¼ë¡œ ë¯¸ë¦¬ ì •ì˜í•´ë‘ì–´ í•´ê²°ê°€ëŠ¥í–ˆë‹¤.*

```jsx
function removeReplyBox(){
			$(".replyBox").remove();
		}
```

### ğŸ”´CHECK POINT

 **: ë‹µê¸€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í´ë¦­ ëœ ë²„íŠ¼ì˜ ë’¤ì— ì…ë ¥ë€ì´ ì¶”ê°€ë˜ê²Œ ì˜ë„í–ˆìœ¼ë‚˜ `append()` ì™€ `after()` ì˜ ì°¨ì´ë¥¼ í˜¼ë™í•˜ì—¬ í´ë¦­ ë˜ëŠ” ë²„íŠ¼ ë’¤ì— `append()`  ì´ìš©í•˜ì—¬ html íƒœê·¸ë¥¼ ì‚½ì…í•˜ë ¤ë‹¤ ë˜ì§€ ì•Šì•„ ì ì‹œ í—¤ë§¸ì—ˆë‹¤. ë¹„ìŠ·í•˜ì§€ë§Œ ë‹¤ë¥¸ ìš”ì†Œ ì‚½ì… ë©”ì†Œë“œë“¤ì„ ì •ë¦¬í•  í•„ìš”ê°€ ìˆë‹¤.**

ğŸŒŸ **append(), prepend(), after(), before() ê°„ë‹¨ ì°¨ì´**

```sql
<p> /*ê¸°ì¡´ìš”ì†Œ*/ </p>

**append()** :  <p>  /*ê¸°ì¡´ìš”ì†Œ*/    **append()** </p>
**prepend()** : <p>  **prepend()** <p>  /*ê¸°ì¡´ìš”ì†Œ*/  </p>
**after()** :  <p> /*ê¸°ì¡´ìš”ì†Œ*/  </p> **prepend()**
**before()** : **before()** <p>  /*ê¸°ì¡´ìš”ì†Œ*/ <p>   
```

## âš« Controller

### EnrollReComment.java

- ì¼ë°˜ ëŒ“ê¸€ ë“±ë¡ê³¼ í° ì°¨ì´ëŠ” ì—†ì§€ë§Œ **ë¶€ëª¨ì˜ ëŒ“ê¸€ë²ˆí˜¸ë¥¼ DBì— ê°™ì´ INSERT** í•´ì¤˜ì•¼ í•˜ì—¬ ì¿¼ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ ì§€ì •í• ê¹Œ ìƒê°í•˜ë‹¤ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì•„ì˜ˆ ë¶„ë¦¬í–ˆë‹¤.
- `int cParentNo = Integer.parseInt(cParent);`  â†’ ë¶€ëª¨ì˜ ëŒ“ê¸€ ë²ˆí˜¸

```java
User loginUser = (User)(request.getSession().getAttribute("loginUser"));
		EventComment ec = new EventComment();
		String nickName = null;
		String emailId = null;
		int cPwd = 0;
		int result = 0;
		
		int eno = Integer.parseInt(request.getParameter("eno"));
		String cParent = request.getParameter("cNum");
		System.out.println("ë‹µê¸€ ì„œë¸”ë¦¿ ë¶€ëª¨ ëŒ“ê¸€ ë²ˆí˜¸: " + cParent);
		int cParentNo = Integer.parseInt(cParent);
		String comment = request.getParameter("comment");

		if(cParentNo != 0) { //ë¶€ëª¨ ëŒ“ê¸€ ì¡´ì¬í•˜ë©´ ì…‹íŒ…
			ec.setcParent(cParentNo);
		}
		
		if(eno != 0 && comment != null && comment !="") {
			ec.seteNo(eno);
			ec.setComment(comment);
		}

		if(loginUser == null) {
			nickName = request.getParameter("nickname");
			cPwd = Integer.parseInt(request.getParameter("cPwd"));
			System.out.println(nickName);
			ec.setName(nickName);
			ec.setePwd(cPwd);
			result = new EventService().anonymousReComment(ec);

		}else {
			emailId = loginUser.getEmailId();
			ec.setEmailId(emailId);
			result = new EventService().enrollReComment(ec);

		}
		
		  if(result > 0) {
		  response.sendRedirect(request.getContextPath()+"/eDetail.do?eno="+eno);
		  
		  }else { request.getSession().setAttribute("msg", "ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨");
		  response.sendRedirect("views/common/errorPage.jsp");
		  
		  }
		
	}
```

### EventService.java

```java
//ìµëª… ëŒ“ê¸€ ë“±ë¡
public int anonymousReComment(EventComment ec) {
		Connection conn = getConnection();
		
		int result = new EventDao().anonymousReComment(conn, ec);
		
		if(result > 0 ) {
			commit(conn);
		}else {
			rollback(conn);
		}
		close(conn);
		
		return result;
	}
// ë¡œê·¸ì¸ ìœ ì € ëŒ“ê¸€ ë“±ë¡
	public int enrollReComment(EventComment ec) {
		Connection conn = getConnection();
		
		int result = new EventDao().enrollReComment(conn, ec);
		
		if(result > 0 ) {
			commit(conn);
		}else {
			rollback(conn);
		}
		close(conn);
		
		return result;
	}
```

### EventDao.java

- ì¼ë°˜ ëŒ“ê¸€ ë“±ë¡ê³¼ ì°¨ì´ì ì€ ë¶€ëª¨ëŒ“ê¸€ë²ˆí˜¸ê°€ ì¶”ê°€ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒ ë°–ì— ì—†ë‹¤.

```java
//ìµëª… ëŒ“ê¸€ ë“±ë¡
public int anonymousReComment(Connection conn, EventComment ec) {
		
		PreparedStatement pstmt = null;
		String sql = 
"INSERT INTO E_COMMENT VALUES(SEQ_E_COMMENT.NEXTVAL,?,?,?,SYSDATE,?,?)";
		int result = 0;
		
		System.out.println("ìµëª… ëŒ“ê¸€ ë“±ë¡ dao : " + ec);
		try {
			pstmt = conn.prepareStatement(sql);
			pstmt.setInt(1, ec.geteNo());
			pstmt.setString(2, ec.getName());
			pstmt.setInt(3, ec.getePwd());
			pstmt.setInt(4, ec.getcParent());
			pstmt.setString(5, ec.getComment());
			
			result = pstmt.executeUpdate();
			System.out.println("dao result: " + result);
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}finally {
			close(pstmt);
			
		}

		return result;
	}

//ë¡œê·¸ì¸ ìœ ì € ëŒ“ê¸€ ë“±ë¡
	public int enrollReComment(Connection conn, EventComment ec) {

		PreparedStatement pstmt = null;
		String sql = 
"INSERT INTO E_COMMENT VALUES(SEQ_E_COMMENT.NEXTVAL,?,?,NULL,SYSDATE,?,?)";
		int result = 0;
	
		try {
			pstmt = conn.prepareStatement(sql);
			pstmt.setInt(1, ec.geteNo());
			pstmt.setString(2, ec.getEmailId());
			pstmt.setInt(3, ec.getcParent());
			pstmt.setString(4, ec.getComment());
			
			result = pstmt.executeUpdate();
			System.out.println("dao result: " + result);
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}finally {
			close(pstmt);
			
		}
		return result;
	}
```

# âœ”ï¸ ëŒ€ëŒ“ê¸€ ìˆ˜ì •

- ìˆ˜ì •ì€ ê¸°ì¡´ì˜ ë§Œë“¤ì–´ ë‘” ìˆ˜ì • ë²„íŠ¼ì„ ê°™ì´ ì‚¬ìš©í•  ìƒê° ì¤‘ì´ë‹¤.

```jsx
$(".updateBtn").on("click",function(){
					var cno = $(this).next().next().val();
					$(this).prev().prev().attr("disabled",false);
					
					 $(this).prev().prev().trigger("keyup");
					comment = $(this).prev().prev().val();				 
					
					$(this).attr("value","ì™„ë£Œ").on("click",function(){
					 	var eno = <%=e.geteNo()%>;
						location.href="<%=request.getContextPath()%>/update.eco?cno="+cno+"&comment="+comment+"&eno="+eno;		
					}); 
					
				});
```

### ğŸ”´ CHECK POINT

: ìš”ì†Œë¥¼ ì„ íƒí•  ë•Œ `**next().next()**` ë˜ëŠ” `**prev().prev()**` ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í•œ ì¹¸ í•œ ì¹¸ ì´ë™í•˜ì—¬ ì°¾ì•„ê°€ëŠ” ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì§œë‹¤ê°€ ì´ëŠ” í•œëˆˆì— ì•Œì•„ë³´ê¸°ë„ í˜ë“¤ê³  ê¹”ë”í•œ ì½”ë”©ì´ ì•„ë‹Œ ê²ƒ ê°™ì•„ ì¤‘ê°„ì— `**.siblings()**`  ìœ¼ë¡œ ìˆ˜ì •ì„ í•˜ê²Œ ë˜ì—ˆë‹¤. **í˜•ì œ ìš”ì†Œ ì¤‘ì— ì§€ì •í•œ ì„ íƒìì— í•´ë‹¹í•˜ëŠ” ìš”ì†Œë¥¼ ëª¨ë‘ ì„ íƒ**í•˜ê²Œ ë˜ëŠ”ë°..! ì´ ë¶€ë¶„ì„ ìƒê°í•˜ì§€ ëª»í•˜ê³  ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë‹ˆ *í´ë¦­ ì‹œ  ìˆ˜ì •í•˜ë ¤ëŠ” ëŒ“ê¸€ ë¿ë§Œ ì•„ë‹ˆë¼ í™”ë©´ì˜ ëª¨ë“  ëŒ“ê¸€ì´ ìˆ˜ì •ëª¨ë“œë¡œ ë°”ë€Œì–´ ë²„ë ¸ë‹¤.* 

â†’ ë‹¤ì‹œ ì›ë˜ ì½”ë“œë¡œ ìˆ˜ì •í•´ ë†“ì€ ìƒíƒœì´ê¸°ëŠ” í•˜ë‚˜,  ***ëŒ€ëŒ“ê¸€ ì¡°íšŒë¥¼ êµ¬í˜„í•œ í›„ ê°™ì€ ë²„íŠ¼ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ë¥¸ ë°©ë²•ì„ ìƒê°í•´ë³´ê±°ë‚˜ ë²„íŠ¼ì„ ë¶„ë¦¬í•´ì•¼ í•  ê²ƒ ê°™ë‹¤***. ë‘ ì½”ë“œì˜ íƒœê·¸ êµ¬ì„±ì´ ì•½ê°„ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ê·¸ëŒ€ë¡œ ì‚¬ìš© í•˜ë©´ 	`comment = $(this).prev().prev().val();`	ì´ ë¶€ë¶„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²ƒì´ë‹¤. ë²„íŠ¼ì„ í´ë¦­í•œ ***$(this) ì˜ prev() prev()ëŠ” ê·¸ ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ê°ì²´ì´ê¸° ë•Œë¬¸ì´ë‹¤.***
