
ì„¸ë¯¸í”„ë¡œì íŠ¸ ê°œì„ ì„ í†µí•´ ëŒ“ê¸€ ê¸°ëŠ¥ êµ¬í˜„ ì—°ìŠµì¤‘ì´ë‹¤.

Github : https://github.com/sunyoring/CrowdFundingUpgrade
Notion :  https://charming-galleon-9a5.notion.site/2-2021-09-30-4013960760d74f70bc44f7c3cc697356



# 1. ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ìœ ì €ë„ ëŒ“ê¸€ ì‘ì„± ê°€ëŠ¥

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/35d56d49-98b6-481e-b9d0-6269c305c1b4/Untitled.png)

### âœ”ï¸  **eventDetailView.jsp**

 â†’ `loginUser` ê°€ `null` ì¼ ê²½ìš° ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ `input` ë…¸ì¶œ

```java
<form method="post" action="<%=request.getContextPath()%>/enrollComment.ev">
			<input type="hidden" name="eno" value="<%=e.geteNo()%>">
			
				<%
					if (loginUser != null) {
				%>
				<input type="hidden" name="emailId"
					value="<%=loginUser.getEmailId()%>">
				<%
					} else {
				%>
				ë‹‰ë„¤ì„ : <input type="text" name="nickname">
				ë¹„ë°€ë²ˆí˜¸ : <input type="password" name="cPwd" maxlengh="4">
				
				<%
					}
				%>
				<textarea name="comment" class="comment"
					maxlength="1000" > </textarea>
	
				<input type="submit" id="commentBtn" value="ëŒ“ê¸€ ë“±ë¡">
			</form>
```

### âœ”ï¸ **EnrollCommentServlet.java**

â†’ ë¡œê·¸ì¸í•œ ê²½ìš°ì—ëŠ” `emailId` ë¥¼ í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” `nickName`ê³¼ `cPwd` ë¥¼ ë„£ì–´ ê°ì²´ ìƒì„±

```java
String nickName = null;
		String emailId = null;
		int cPwd = 0;

		if(loginUser == null) {
			nickName = request.getParameter("nickname");
			cPwd = Integer.parseInt(request.getParameter("cPwd"));
		}else {
			emailId = loginUser.getEmailId();

		}

int cParent; //ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥ì„ ìœ„í•´ ì„ì‹œ ì„ ì–¸í•´ ë‘ .

int eno = Integer.parseInt(request.getParameter("eno"));
String comment = request.getParameter("comment");

EventComment ec = new EventComment();

	//ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹ ë• ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê°ì²´ì— set
		if(nickName != null && nickName !="" && cPwd !=0) {
			ec.setEmailId(nickName);
			ec.setePwd(cPwd);
		}else { //ì•„ë‹ˆë¼ë©´ ë¡œê·¸ì¸í•œ ê³„ì •ì˜ ì´ë©”ì¼ ì•„ì´ë””ë¥¼ ë„£ì„ ê²ƒ.
			ec.setEmailId(emailId);

		if(eno != 0 && comment != null && comment !="") {
			ec.seteNo(eno);
			ec.setComment(comment);
		}

```

```java
int result = new EventService().enrollComment(ec);
		
		if(result > 0) {
			response.sendRedirect(request.getContextPath()+"/eDetail.do?eno="+eno);

		}else {
			request.getSession().setAttribute("msg", "ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨");
			response.sendRedirect("views/common/errorPage.jsp");

		}
```

### âœ”ï¸EventService.java

```java
public int enrollComment(EventComment eventComment) {
		Connection conn = getConnection();
		
		int result = new EventDao().enrollComment(conn, eventComment);
		
		if(result > 0 ) {
			commit(conn);
		}else {
			rollback(conn);
		}
		close(conn);
		
		return result;
	}
```

### âœ”ï¸ EventDao.java

```java
public int enrollComment(Connection conn, EventComment ec) {
		
		PreparedStatement pstmt = null;
		String sql = "INSERT INTO E_COMMENT VALUES(SEQ_E_COMMENT.NEXTVAL,?,?,NULL,SYSDATE,NULL,?)";
		int result = 0;
	
		try {
			pstmt = conn.prepareStatement(sql);
			pstmt.setInt(1, ec.geteNo());
			pstmt.setString(2, ec.getEmailId());
			pstmt.setString(3, ec.getComment());
			
			result = pstmt.executeUpdate();
			System.out.println("dao result: " + result);
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}finally {
			close(pstmt);
			
		}
		return result;
	}
```

# 2. ë³¸ì¸ì´ ì‘ì„±í•œ ëŒ“ê¸€ì— ìˆ˜ì •, ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€

**â†’ ì¿¼ë¦¬ë¥¼ ìˆ˜ì •í•˜ì—¬ ì‘ì„±ìì˜ ì•„ì´ë””ê°€ ì•„ë‹ˆë¼ ì´ë¦„ì´ ë³´ì´ë„ë¡ ë³€ê²½**

**â†’ ìµœì‹  ì‘ì„± ëœ ëŒ“ê¸€ ìˆœìœ¼ë¡œ ë³´ì´ë„ë¡ í•˜ê¸° ìœ„í•´ ë“±ë¡ì¼ì ë³„ë¡œ ì •ë ¬**

```sql
**SELECT
    B.USER_NAME,
    A.* 
FROM E_COMMENT A
LEFT JOIN USER_TB B ON A.C_ID = B.EMAIL_ID
WHERE A.E_NO=132
ORDER BY A.C_DATE ASC;**
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/afa3acdf-c083-498d-91f9-34b4e15fb693/Untitled.png)

***â†’ ì‘ì„±ìê°€ null ì¸ ê²½ìš°ëŠ” ìµëª…ì˜ ì‘ì„±ìë¡œ ë‹‰ë„¤ì„ìœ¼ë¡œ í‘œì‹œë˜ë„ë¡ ë°˜ì˜í•  ì˜ˆì •.***

### âœ”ï¸EventDetailView.jsp  [AJAX]

- ëŒ“ê¸€ ì¡°íšŒ ajax í†µì‹ ìœ¼ë¡œ ë°›ì•„ì˜¤ëŠ” ë¦¬ìŠ¤íŠ¸ì˜ ëŒ“ê¸€ ê°ì²´ë§ˆë‹¤ ì´ë©”ì¼ ì•„ì´ë””ë¥¼ í™•ì¸í•˜ê³  , ë¡œê·¸ì¸ì„ í–ˆì„ ê²½ìš° ë³¸ì¸ì´ ì‘ì„±í•œ ëŒ“ê¸€ ì˜†ì— ìˆ˜ì • ì‚­ì œ ë²„íŠ¼ì„ ë…¸ì¶œ ì‹œí‚¤ë„ë¡ ì½”ë“œë¥¼ ì¶”ê°€
- ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ í•´ë‹¹ ëŒ“ê¸€ì„ ìˆ˜ì •ê°€ëŠ¥ í•œ ìƒíƒœë¡œ ë°”ê¾¸ê³  ìˆ˜ì • ë²„íŠ¼ì„ ì™„ë£Œ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½í•œë‹¤.	**`$(this).prev().attr("disabled",false);`**

```jsx

success : function(list){
	console.log(list);
		
	list.forEach((cm => {

		commentBox.append(`
				<br>
				<b>ì‘ì„±ì : </b> \${cm.name} 
				<br>
				
				<textarea name="comment" class="comment"  maxlength="1000" disabled> \${cm.comment}</textarea>
				`)
				<% if(loginUser != null){%>
				if(cm.emailId == "<%=loginUser.getEmailId()%>"){
					commentBox.append(`
							<input type="button" id="updateBtn" value="ìˆ˜ì •">
							<input type="button" value="X" onclick="goDelete();">
							<input type="hidden" name="cNum" value=\${cm.cNum}>
					`)
				}
				<%}%>
		
	}
	));
```

### ğŸ”´ CHECK POINT

ìˆ˜ì • ëœ ë‚´ìš©ì„ ì„œë¸”ë¦¿ìœ¼ë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´  `textarea`  ì˜ ê°’ì„ `comment` ë³€ìˆ˜ì—  ë„£ì–´ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë„˜ê²¨ì£¼ì—ˆëŠ”ë° ë„ˆë¬´ ê°„ë‹¨í•˜ê²Œ ìƒê°í•œ ê²ƒì¸ì§€ ì˜ ë˜ì§€ ì•Šì•˜ë‹¤. ë¬¸ì œëŠ” ìˆ˜ì •ëœ ê°’ì´ ì•„ë‹ˆë¼ ê¸°ì¡´ì˜ ê°’ìœ¼ë¡œ ë„˜ì–´ê°„ë‹¤ëŠ” ê²ƒì¸ë° ê·¸ë˜ì„œ  `keyup` ì´ë²¤íŠ¸ë¥¼ ê±¸ë©´ ë³€ê²½ ë‚´ìš©ìœ¼ë¡œ ë°”ë¡œë°”ë¡œ ë°”ì¸ë”© ë˜ì§€ ì•Šì„ê¹Œ í•˜ì—¬ ì‹œë„í•´ë³´ì•˜ëŠ”ë° ë§ˆì°¬ê°€ì§€ë¡œ ì‹¤íŒ¨í•˜ì˜€ë‹¤ ã… ã… 

 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2754030a-8993-41ff-a4b9-e17ba6b1b805/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2b70bd7c-a47a-4353-b91c-99e3fde8413f/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a5f84b59-9e8b-4e5c-8634-cd0a5d0ae8c5/Untitled.png)

â†’ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠëŠ”ë‹¤..!

ê·¸ë˜ì„œ êµ¬ê¸€ë§ì„ í†µí•´ ì´ëŸ´ ê²½ìš°ì—ëŠ”  `trigger()` í•¨ìˆ˜ë¥¼ ì´ìš©í•œ ë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆë‹¤ .

`trigger()` : ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ì‹¤í–‰ë  í•¨ìˆ˜ë‚˜ `.bind()` í•¨ìˆ˜ë¡œ ì—°ê²°ëœ ì–´ë– í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ê°•ì œë¡œ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤.

**<ê¸°ì¡´ì½”ë“œ>**

```jsx
$(this).prev().on("keyup",funciton(){
comment = $(this).prev().val();
})
```

**<ìˆ˜ì • ì½”ë“œ>**

```jsx
	$("#updateBtn").on("click",function(){

		var cno = $(this).next().next().val();
		$(this).prev().attr("disabled",false);
		$(this).prev().trigger("keyup");
		comment = $(this).prev().val();
		
		$(this).attr("value","ì™„ë£Œ").on("click",function(){
			location.href="<%=request.getContextPath()%>/update.eco?cno="+cno+"&comment="+comment;
		});
	})				
}
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c8099b49-5ac5-4582-8fd3-cf55c5f13b7e/Untitled.png)

â†’ ê°„ë‹¨í•˜ê²Œ 		`$(this).prev().trigger("keyup");`
ì½”ë“œë¥¼ í•œ ì¤„ ì¶”ê°€í•˜ê³  ë‚˜ë‹ˆ ìˆ˜ì • í›„ ë³€ê²½ ëœ ê°’ìœ¼ë¡œ ì˜ ë„˜ì–´ì˜¤ëŠ” ê²ƒì„ í™•ì¸ í•˜ì˜€ë‹¤.

- **ì •ë¦¬ë¥¼ í•˜ë©´ì„œ ë‹¤ì‹œ ì½”ë“œë¥¼ ì‚´í´ ë³¸ ê²°ê³¼ `comment` ë³€ìˆ˜ì˜ ìœ íš¨ë²”ìœ„ë•Œë¬¸ì´ ì•„ë‹ˆì—ˆì„ê¹Œ ì‹¶ê¸°ë„ í•˜ë‹¤.  ì¼ë‹¨ `trriger()`   í•¨ìˆ˜ë¥¼ ì²˜ìŒ ì ‘í•´ë³´ì•˜ëŠ”ë° ê¸°ì–µí•´ë‘ë©´ ìœ ìš©í•˜ê²Œ ë˜ ìì£¼ ì‚¬ìš©í•˜ê²Œ ë˜ì§€ ì•Šì„ê¹Œ ì‹¶ë‹¤.**
